THREE.TransformControls=function(a,b){function c(a,b,c){for(var d=b.intersectObject(a,!0),e=0;e<d.length;e++)if(d[e].object.visible||c)return d[e];return!1}function d(a,b){var c=b;Object.defineProperty(l,a,{get:function(){return c===void 0?b:c},set:function(b){c!==b&&(c=b,k[a]=b,l.dispatchEvent({type:a+"-changed",value:b}),l.dispatchEvent(m))}}),l[a]=b,k[a]=b}function e(a){if(l.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};var c=a.changedTouches?a.changedTouches[0]:a,d=b.getBoundingClientRect();return{x:2*((c.clientX-d.left)/d.width)-1,y:2*(-(c.clientY-d.top)/d.height)+1,button:a.button}}function f(a){if(l.enabled)switch(a.pointerType){case"mouse":case"pen":l.pointerHover(e(a));}}function g(a){l.enabled&&(l.domElement.style.touchAction="none",l.domElement.ownerDocument.addEventListener("pointermove",h,!1),l.pointerHover(e(a)),l.pointerDown(e(a)))}function h(a){l.enabled&&l.pointerMove(e(a))}function j(a){l.enabled&&(l.domElement.style.touchAction="",l.domElement.ownerDocument.removeEventListener("pointermove",h,!1),l.pointerUp(e(a)))}b===void 0&&(console.warn("THREE.TransformControls: The second parameter \"domElement\" is now mandatory."),b=document),THREE.Object3D.call(this),this.visible=!1,this.domElement=b;var k=new THREE.TransformControlsPlane;this.add(k);var l=this;d("camera",a),d("object",void 0),d("enabled",!0),d("axis",null),d("mode","translate"),d("translationSnap",null),d("rotationSnap",null),d("scaleSnap",null),d("space","world"),d("size",1),d("dragging",!1),d("showX",!0),d("showY",!0),d("showZ",!0);var m={type:"change"},n={type:"mouseDown"},o={type:"mouseUp",mode:l.mode},p={type:"objectChange"},q=new THREE.Raycaster,r=new THREE.Vector3,s=new THREE.Quaternion,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3,x=0,y=new THREE.Vector3,z=new THREE.Quaternion,A=new THREE.Vector3,B=new THREE.Vector3,C=new THREE.Quaternion,D=new THREE.Quaternion,E=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Quaternion,H=new THREE.Vector3,I=new THREE.Vector3,J=new THREE.Quaternion,K=new THREE.Quaternion,L=new THREE.Vector3,M=new THREE.Vector3,N=new THREE.Quaternion;d("worldPosition",I),d("worldPositionStart",F),d("worldQuaternion",J),d("worldQuaternionStart",G),d("cameraPosition",y),d("cameraQuaternion",z),d("pointStart",t),d("pointEnd",u),d("rotationAxis",w),d("rotationAngle",x),d("eye",M),b.addEventListener("pointerdown",g,!1),b.addEventListener("pointermove",f,!1),l.domElement.ownerDocument.addEventListener("pointerup",j,!1),this.dispose=function(){b.removeEventListener("pointerdown",g),b.removeEventListener("pointermove",f),l.domElement.ownerDocument.removeEventListener("pointermove",h),l.domElement.ownerDocument.removeEventListener("pointerup",j),this.traverse(function(a){a.geometry&&a.geometry.dispose(),a.material&&a.material.dispose()}),this.detach()},this.attach=function(a){return this.object=a,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){this.object!==void 0&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(B,C,E),this.object.matrixWorld.decompose(I,J,L),D.copy(C).invert(),K.copy(J).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(y,z,A),M.copy(y).sub(I).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(a){if(void 0!==this.object&&!0!==this.dragging){q.setFromCamera(a,this.camera);var b=c(this.object,q);this.axis=b?"XYZE":null}},this.pointerDown=function(a){if(void 0!==this.object&&!0!==this.dragging&&0===a.button&&null!==this.axis){q.setFromCamera(a,this.camera);var b=c(k,q,!0);if(b){if("rotate"===this.mode){var d=this.rotationSnap;"X"===this.axis&&d&&(this.object.rotation.x=Math.round(this.object.rotation.x/d)*d),"Y"===this.axis&&d&&(this.object.rotation.y=Math.round(this.object.rotation.y/d)*d),"Z"===this.axis&&d&&(this.object.rotation.z=Math.round(this.object.rotation.z/d)*d)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),N.copy(this.object.quaternion),this.object.matrixWorld.decompose(F,G,H),t.copy(b.point).sub(F)}this.dragging=!0,n.mode=this.mode,this.dispatchEvent(n)}},this.pointerMove=function(a){var b=this.axis,d=this.mode,e=this.object;if(void 0!==e&&null!==b&&!1!==this.dragging&&-1===a.button){q.setFromCamera(a,this.camera);var f=c(k,q,!0);if(f){if(u.copy(f.point).sub(F),"rotate"===d){v.copy(u).sub(t);var g=5/I.distanceTo(r.setFromMatrixPosition(this.camera.matrixWorld));"XYZE"===b&&(w.copy(v).cross(M).normalize(),x=v.dot(r.copy(w).cross(this.eye))*g),this.rotationSnap&&(x=Math.round(x/this.rotationSnap)*this.rotationSnap),this.rotationAngle=x,"XYZE"===b&&(w.applyQuaternion(D),e.quaternion.copy(s.setFromAxisAngle(w,x)),e.quaternion.multiply(N).normalize())}this.dispatchEvent(m),this.dispatchEvent(p)}}},this.pointerUp=function(a){0!==a.button||(this.dragging&&null!==this.axis&&(o.mode=this.mode,this.dispatchEvent(o)),this.dragging=!1,this.axis=null)},this.getMode=function(){return l.mode},this.setMode=function(a){l.mode=a},this.setRotationSnap=function(a){l.rotationSnap=a},this.setSize=function(a){l.size=a},this.setSpace=function(a){l.space=a},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane";var a=new THREE.Vector3(1,0,0),b=new THREE.Vector3(0,1,0),c=new THREE.Vector3(0,0,1),d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Matrix4,h=new THREE.Quaternion;this.updateMatrixWorld=function(){this.position.copy(this.worldPosition),a.set(1,0,0).applyQuaternion(h),b.set(0,1,0).applyQuaternion(h),c.set(0,0,1).applyQuaternion(h),f.copy(b),e.set(0,0,0),0===e.length()?this.quaternion.copy(this.cameraQuaternion):(g.lookAt(d.set(0,0,0),e,f),this.quaternion.setFromRotationMatrix(g)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0});AFRAME.registerComponent("animation-on-click-run",{schema:{blackboardData:{parse:JSON.parse,stringify:JSON.stringify}},dependencies:["animation__onclick"],init:function(){const a=this.el;this.data.blackboardData.jsonData.id=a.id;const b=this.data.blackboardData;"text-pane"===b.componentType?a.sceneEl.emit("initializeObject",{id:a.id,solved:!0}):a.sceneEl.emit("initializeObject",{id:a.id,solved:!1}),this.el.addEventListener("animationbegin",function(){}),this.el.addEventListener("animationcomplete",function(a){if("animation__onclick"===a.detail.name)addEntityToBlackboard(b);else if("animation__onclick_tutorial"===a.detail.name){const a=document.getElementById("returnButton");a.setAttribute("class","link"),a.setAttribute("visible","true"),addEntityToBlackboard(b)}})}});function addEntityToBlackboard(a){let b=document.querySelector("#blackboard"),c=document.createElement("a-entity");a.jsonData.isBlackboardParagraphDefined=a.hasOwnProperty("blackboardParagraph"),a.jsonData.isBlackboardTextDefined=a.hasOwnProperty("blackboardText"),c.setAttribute(a.componentType,"jsonData",JSON.stringify(a.jsonData)),c.setAttribute("bind__"+a.componentType,"isSolved: solvedObjects"),c.addEventListener("loaded",function(b){if(b.target===c){let b=document.querySelector("#popup-camera");if(b.setAttribute("camera","active",!0),a.hasOwnProperty("blackboardText")){let b=document.querySelector("#blackboardText");const c=a.blackboardText,d=a.hasOwnProperty("blackboardTextColor")?a.blackboardTextColor:"white",e=b.getAttribute("text").width,f=Math.max(Math.min(c.length,60),e+5);b.setAttribute("text",{color:d,width:e,wrapCount:f,value:c,font:"https://raw.githubusercontent.com/jaydhulia/aframe-fonts/master/fonts/poppins/Poppins-Bold.json",shader:"msdf"})}if(a.hasOwnProperty("blackboardParagraph")){let b=document.querySelector("#blackboardParagraph");const c=a.blackboardParagraph,d=a.hasOwnProperty("blackboardParagraphColor")?a.blackboardParagraphColor:"white";b.setAttribute("text",{color:d,value:c,font:"https://raw.githubusercontent.com/jaydhulia/aframe-fonts/master/fonts/poppins/Poppins-Medium.json",shader:"msdf"})}a.hasOwnProperty("draggable")&&a.draggable&&b.setAttribute("drag-controls","objects: .draggable")}}),b.appendChild(c)}AFRAME.registerComponent("button-design",{init:function(){this.hovering=!1,this.el.addEventListener("raycaster-intersected",()=>{this.hovering=!0}),this.el.addEventListener("raycaster-intersected-cleared",()=>{this.hovering=!1,this.el.children[0].setAttribute("color","white")})},tick:function(){this.hovering&&this.el.children[0].setAttribute("color","#6d6d6d")}});AFRAME.registerComponent("close-popup",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify}},multiple:!0,init:function(){const a=this.data.jsonData,b=this.el;b.setAttribute("geometry",{primitive:"box",width:a.width,height:a.height,depth:a.depth}),b.setAttribute("material",{color:a.color,shader:"flat",transparent:!0,opacity:a.opacity}),b.setAttribute("position",{x:a.x,y:a.y,z:a.z}),b.addEventListener("click",function(){b.hasAttribute("tutorial-hints")||closePopup(0,!1,b)}),b.sceneEl.addEventListener("dcc-success-close-popup",function(a){closePopup(a.detail.seconds,a.detail.is_last_object,b)})}});let sceneSolved=!1;async function closePopup(a,b,c){sceneSolved||setTimeout(function(){const a=document.querySelector("#primaryCamera");a.setAttribute("camera","active",!0),wipeBlackboard(),b&&(sceneSolved=!0,c.setAttribute("visible",!1),c.sceneEl.emit("dcc-success-scene-complete"))},1e3*a)}function wipeBlackboard(){let a=document.querySelector("#blackboard"),b=document.querySelector("#blackboardText");b.setAttribute("text","value","");let c=document.querySelector("#blackboardParagraph");for(c.setAttribute("text","value","");a.firstChild;)a.removeChild(a.lastChild)}AFRAME.registerComponent("hint-button",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify}},multiple:!0,init:function(){const a=this.data.jsonData;let b=-.5,c=52*visibleWidthAtZDepth(b)/100-a.width,d=-visibleHeightAtZDepth(b)/2+a.height;this.hintIcon=document.createElement("a-image"),this.hintIcon.setAttribute("id","hint-icon"),this.hintIcon.setAttribute("src",a.newHintImg),this.hintIcon.setAttribute("width",a.width),this.hintIcon.setAttribute("height",a.height),this.hintIcon.setAttribute("class","link"),this.hintIcon.object3D.position.set(c,d,b);const e=this.hintIcon;this.hintIcon.addEventListener("click",function(){e.setAttribute("src",a.hintImg)}),this.el.appendChild(this.hintIcon),window.addEventListener("resize",function(){const b=-.5,c=visibleWidthAtZDepth(b)/2-a.width,d=-visibleHeightAtZDepth(b)/2+a.height;e.object3D.position.set(c,d,b)})}});function visibleHeightAtZDepth(a){const b=document.querySelector("#primaryCamera"),c=b.getAttribute("fov")*Math.PI/180;return 2*Math.tan(c/2)*Math.abs(a)}function visibleWidthAtZDepth(a){const b=visibleHeightAtZDepth(a),c=window.innerWidth/window.innerHeight;return b*c}AFRAME.registerComponent("interactable",{init:function(){let a=this.el,b=a.object3D;a.addEventListener("model-loaded",function(){let c=new THREE.Box3().setFromObject(b),d=c.getSize();const e=a.getAttribute("scale"),f=e.x,g=e.y,h=e.z,j=d.x,k=d.y,l=d.z;let m=Math.max(j,k,l);m=(m+.05)/m;const n=f*m,o=g*m,p=h*m;a.setAttribute("animation__mouseenter",`property: scale; to: ${n} ${o} ${p}; dur: 100; startEvents: mouseenter`),a.setAttribute("animation__mouseleave",`property: scale; to: ${f} ${g} ${h}; dur: 100; startEvents: mouseleave`)})}});AFRAME.registerComponent("jigsaw-puzzle",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify},isSolved:{type:"map"}},multiple:!0,init:function(){const a=this.data.jsonData,b=this.el;this.id=a.id,a.isBlackboardParagraphDefined?(b.setAttribute("scale",{x:.8,y:.8,z:.8}),b.setAttribute("position","y",.7)):(b.setAttribute("scale",{x:1,y:1,z:1}),b.setAttribute("position","y",0));const c=a.hasOwnProperty("puzzleDimension")?a.puzzleDimension:3,d=Array.from(Array(c).keys()).map(a=>1.1*(a-(c/2-1/2))),e=d.slice(0).reverse();let f=e.flatMap(a=>d.map(b=>[b,a])),g=f.slice(0);shuffleArray(g);let h=[];for(i=0;i<a.images.length;++i){let b={};b.imageSrc=a.images[i],b.xTarget=f[i][0],b.yTarget=f[i][1],b.x=g[i][0],b.y=g[i][1],h.push(b)}ordered_puzzle_json={id:this.id,images:h,useTargets:!0,randomizePos:!1,isJigsaw:!0,scaleBy:a.hasOwnProperty("scaleBy")?a.scaleBy:3,is_last_object:!!("is_last_object"in a)&&a.is_last_object},this.ordered_puzzle=document.createElement("a-entity"),this.ordered_puzzle.setAttribute("id","ordered-puzzle"),this.ordered_puzzle.setAttribute("ordered-puzzle","jsonData",JSON.stringify(ordered_puzzle_json)),this.ordered_puzzle.setAttribute("bind__ordered-puzzle","isSolved: solvedObjects"),this.el.appendChild(this.ordered_puzzle)}});function shuffleArray(a){for(i=a.length-1;0<i;i--){let b=Math.floor(Math.random()*(i+1)),c=a[i];a[i]=a[b],a[b]=c}}AFRAME.registerComponent("keypad",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify},isSolved:{type:"map"}},multiple:!0,init:function(){const a=this.data.jsonData,b=a.password,c=this.el;this.id=a.id;let d=this,e=!1;"is_last_object"in a&&(e=a.is_last_object),c.setAttribute("super-keyboard",{imagePath:"/static/img/",multipleInputs:!0,align:"center",model:a.model,maxLength:b.length}),a.isBlackboardParagraphDefined?(c.setAttribute("scale",{x:18,y:18,z:18}),c.setAttribute("position",{x:0,y:.5,z:.5})):(c.setAttribute("scale",{x:20,y:20,z:20}),c.setAttribute("position",{x:0,y:0,z:.5})),c.addEventListener("superkeyboardinput",function(f){if(f.detail.value.toLowerCase()===b.toLowerCase())c.sceneEl.emit("solvedObject",{id:a.id}),c.sceneEl.emit("dcc-success-close-popup",{seconds:2,is_last_object:e});else{const b=c.getAttribute("super-keyboard").label;if("SUCCESS"!==b){let b=document.querySelector("#blackboardText");d.data.hasOwnProperty("prevTextEl")||(d.data.prevTextEl=JSON.parse(JSON.stringify(b.getAttribute("text")))),b.setAttribute("text",{value:a.hasOwnProperty("errorMsg")&&""!==a.errorMsg?a.errorMsg:"ERROR",color:"red",wrapCount:a.hasOwnProperty("errorMsg")&&""!==a.errorMsg?60:"20"}),removeError(d,a.hasOwnProperty("errorMsg")&&""!==a.errorMsg?5:1.5)}}});const f={width:"0.5",height:"0.05",depth:"0.05",color:"green",x:"0",y:"-0.3",z:"0",scaleX:"0.25",scaleY:"0.25",scaleZ:"0.25",text:"Solved",yText:-.04};a.isBlackboardParagraphDefined&&(f.y="-0.25"),this.solvedPuzzleEntity=document.createElement("a-entity"),this.solvedPuzzleEntity.setAttribute("id","keypad-solved-"+this.id),this.solvedPuzzleEntity.setAttribute("text-box","jsonData",JSON.stringify(f)),this.solvedPuzzleEntity.setAttribute("visible","false"),c.appendChild(this.solvedPuzzleEntity)},update:function(){this.puzzleIsSolved=this.data.isSolved[this.id];const a=this.el;if("undefined"==typeof this.puzzleIsSolved);else if(!0===this.puzzleIsSolved){let b=document.querySelector("#blackboardText");this.data.hasOwnProperty("prevTextEl")||(this.data.prevTextEl=JSON.parse(JSON.stringify(b.getAttribute("text")))),b.setAttribute("text",{value:"SUCCESS",color:"green",wrapCount:"20"}),a.setAttribute("super-keyboard",{multipleInputs:!0}),this.solvedPuzzleEntity.setAttribute("visible","true")}else{let a=document.querySelector("#blackboardText");this.data.hasOwnProperty("prevTextEl")&&a.setAttribute("text",this.data.prevTextEl)}}});async function removeError(a,b){setTimeout(function(){if(!a.puzzleIsSolved){let b=document.querySelector("#blackboardText");a.data.hasOwnProperty("prevTextEl")?b.setAttribute("text",a.data.prevTextEl):b.setAttribute("text",{value:"",color:"white",wrapCount:"20"})}},1e3*b)}AFRAME.registerComponent("ordered-puzzle",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify},isSolved:{type:"map"}},multiple:!0,init:function(){const a=this.data.jsonData,b=this.el;this.id=a.id,this.useTargets=a.useTargets,this.alreadyRestored=!1;const c=!!("is_last_object"in a)&&a.is_last_object,d=a.images.length,e=document.querySelector("#blackboard");if(this.puzzlePieceCache=[],a.useTargets){const c={width:"5",height:"1",depth:"1",color:"green",x:"0",y:"-5.75",z:"0",scaleX:"4",scaleY:"4",scaleZ:"2",text:"Solved",yText:-.55};!(a.hasOwnProperty("isJigsaw")&&a.isJigsaw)&&a.isBlackboardParagraphDefined&&(c.y="-2.9"),this.solvedPuzzleEntity=document.createElement("a-entity"),this.solvedPuzzleEntity.setAttribute("id","ordered-puzzle-solved-"+this.id),this.solvedPuzzleEntity.setAttribute("text-box","jsonData",JSON.stringify(c)),this.solvedPuzzleEntity.setAttribute("visible","false"),b.appendChild(this.solvedPuzzleEntity)}else b.sceneEl.emit("solvedObject",{id:a.id});const f=this.puzzlePieceCache,g=a.hasOwnProperty("scaleBy")?a.scaleBy:3;for(let h=0;h<d;h++){this.puzzlePiece=document.createElement("a-image"),this.puzzlePiece.setAttribute("id","puzzle-piece-image-"+h),this.puzzlePiece.setAttribute("src",a.images[h].imageSrc+"?d="+new Date().getTime()/1e3),f.push(this.puzzlePiece);let d=document.createElement("img");d.setAttribute("index",h),d.onload=function(h){const j=h.target.getAttribute("index"),k=f[j];let l=d.height/d.width,m=g*l,n=g;if(a.hasOwnProperty("isJigsaw")&&a.isJigsaw&&(l=d.width/d.height,n=g*l,m=g),k.setAttribute("width",n),k.setAttribute("height",m),k.setAttribute("class","draggable link"),a.randomizePos?(puzzlePieceYOffset=-.5,puzzlePieceYLimit=2,!(a.hasOwnProperty("isJigsaw")&&a.isJigsaw)&&(a.isBlackboardTextDefined&&a.isBlackboardParagraphDefined?(puzzlePieceYOffset=0,puzzlePieceYLimit=5):a.isBlackboardTextDefined?(puzzlePieceYOffset=-.9,puzzlePieceYLimit=3):a.isBlackboardParagraphDefined&&(puzzlePieceYOffset=.8,puzzlePieceYLimit=4)),k.setAttribute("position",{x:(Math.random()-.5)*(e.getAttribute("geometry").width-n),y:(Math.random()-.5)*(e.getAttribute("geometry").height-puzzlePieceYLimit-m)+puzzlePieceYOffset,z:0})):k.setAttribute("position",{x:a.images[j].x*n,y:a.images[j].y*m,z:0}),a.useTargets){let d=JSON.parse(JSON.stringify(a.images[j]));d.color="#3a4355",d.width=n,d.height=m,d.xTarget*=n,d.yTarget*=m;let e=document.createElement("a-entity");e.setAttribute("id","puzzle-target-"+j),e.setAttribute("target-box","jsonData",JSON.stringify(d)),b.appendChild(e),k.setAttribute("xTarget",a.images[j].xTarget*n),k.setAttribute("yTarget",a.images[j].yTarget*m),k.setAttribute("onTarget",!1),k.addEventListener("dragend",function(d){d.target.setAttribute("onTarget",isOnTarget(d.target,g)),isPuzzleComplete(f)&&(b.sceneEl.emit("solvedObject",{id:a.id}),c&&b.sceneEl.emit("dcc-success-close-popup",{seconds:2,is_last_object:c}))}),k.addEventListener("loaded",function(){k.setAttribute("onTarget",isOnTarget(k,g))})}b.appendChild(k)},d.crossOrigin="anonymous",d.src=a.images[h].imageSrc+"?d="+new Date().getTime()}},tick:function(){if(!this.alreadyRestored)if(this.puzzleIsSolved=this.data.isSolved[this.id],"undefined"==typeof this.puzzleIsSolved);else if(!0===this.puzzleIsSolved&&this.useTargets){this.solvedPuzzleEntity.setAttribute("visible","true");let a=0;for(let b=0;b<this.puzzlePieceCache.length;b++){const c=this.puzzlePieceCache[b];let d={x:0,y:0,z:0};if(0<c.object3D.children.length)d=c.object3D.children[0].position;else continue;const e={x:c.getAttribute("xTarget"),y:c.getAttribute("yTarget")};"undefined"!=typeof e.x&&(a++,c.object3D.position.set(parseFloat(e.x)-d.x,parseFloat(e.y)-d.y,0))}a===this.puzzlePieceCache.length&&(this.alreadyRestored=!0)}else;}});function isOnTarget(a,b){const c=a.object3D.children[0].position,d=a.getAttribute("position"),e={x:a.getAttribute("xTarget"),y:a.getAttribute("yTarget")},f=b/3;return Math.abs(d.x+c.x-e.x)<=f&&Math.abs(d.y+c.y-e.y)<=f}function isPuzzleComplete(a){for(var b=0;b<a.length;b++)if("false"===a[b].getAttribute("onTarget"))return!1;return!0}AFRAME.registerComponent("rotation-controls",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify},isSolved:{type:"map"}},multiple:!0,init:function(){function a(){const a=window.innerWidth/window.innerHeight;d.aspect=a,d.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight),b()}function b(){m.render(l,d)}const c=this.data.jsonData;let d,e,{TransformControls:f}=THREE,{el:g}=this,h=this,j=g.object3D,k=g.sceneEl,l=k.object3D,m=k.renderer,n=c.id,o=document.getElementById(n);g.setAttribute("gltf-model",o.getAttribute("src")),g.setAttribute("rotation",o.getAttribute("rotation")),c.hasOwnProperty("position")?g.setAttribute("position",{x:c.position[0],y:c.position[1],z:c.position[2]}):g.setAttribute("position",{x:0,y:2,z:.5}),c.hasOwnProperty("scale")?g.setAttribute("scale",{x:c.scale[0],y:c.scale[1],z:c.scale[2]}):g.setAttribute("scale",o.getAttribute("scale")),g.addEventListener("loaded",function(c){if(c.target===g){let c=document.querySelector("[camera]"),g=function(){d=k.camera,m.setPixelRatio(window.devicePixelRatio),m.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(m.domElement),e=new f(d,m.domElement),e.addEventListener("change",b),e.addEventListener("dragging-changed",function(a){c.setAttribute("look-controls","enabled",`${!a.value}`)}),e.attach(j),l.add(e),window.addEventListener("resize",a),e.setMode("rotate"),Object.assign(h,{camera:d,controls:e})};k.camera===void 0?k.addEventListener("camera-set-active",g,{once:!0}):g()}})},remove:function(){this.controls.dispose()}});AFRAME.registerComponent("target-box",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify}},multiple:!0,init:function(){const a=this.data.jsonData,b=this.el;b.setAttribute("geometry",{primitive:"plane",width:a.width,height:a.height}),b.setAttribute("material",{color:a.color,shader:"flat",transparent:!1}),b.setAttribute("position",{x:a.xTarget,y:a.yTarget,z:0})}});AFRAME.registerComponent("text-box",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify}},multiple:!0,init:function(){const a=this.data.jsonData,b=this.el;b.setAttribute("geometry",{primitive:"plane",width:a.width,height:a.height}),b.setAttribute("material",{color:a.color,shader:"flat",transparent:!1}),b.setAttribute("position",{x:a.x,y:a.y,z:a.z}),this.textLabel=document.createElement("a-text"),this.textLabel.setAttribute("id","text-nav"),this.textLabel.setAttribute("value",a.text),this.textLabel.setAttribute("font","https://raw.githubusercontent.com/jaydhulia/aframe-fonts/master/fonts/poppins/Poppins-Bold.json"),this.textLabel.setAttribute("shader","msdf"),this.textLabel.setAttribute("negate","true"),this.textLabel.setAttribute("scale",{x:a.scaleX,y:a.scaleY,z:a.scaleZ}),this.textLabel.setAttribute("color","white"),this.textLabel.setAttribute("align","center");const c=a.hasOwnProperty("xText")?a.xText:0,d=a.hasOwnProperty("yText")?a.yText:0,e=a.hasOwnProperty("zText")?a.zText:0;this.textLabel.setAttribute("position",{x:c,y:d,z:e}),this.el.appendChild(this.textLabel)}});let start_tutorial_flow=!1;AFRAME.registerComponent("text-pane",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify},isSolved:{type:"map"}},multiple:!0,init:function(){const a=this,b=this.data.jsonData,c=this.el;this.textLabel=document.createElement("a-text"),this.textLabel.setAttribute("id","text"),this.textLabel.setAttribute("value",b.data[b.currPosition].text),this.textLabel.setAttribute("font","https://raw.githubusercontent.com/jaydhulia/aframe-fonts/master/fonts/poppins/Poppins-Medium.json"),this.textLabel.setAttribute("shader","msdf"),this.textLabel.setAttribute("negate","true"),this.textLabel.setAttribute("scale","2 2 1"),this.textLabel.setAttribute("position","-4.9 0 0.25"),c.appendChild(this.textLabel);const d=this.textLabel;let e;b.data[b.currPosition].hasOwnProperty("imageSrc")&&(e=createVisualPane(b,c),this.textLabel.setAttribute("visible",!1));const f={width:"2",height:"1",depth:"0.005",color:"#242424",x:"7.7",y:"-6.8",z:"0.005",scaleX:"2",scaleY:"2",scaleZ:"1",text:1===b.data.length?"Got it!":"Next"};this.leftNav=document.createElement("a-entity"),this.leftNav.setAttribute("id","nav-button-left"),this.leftNav.setAttribute("text-box","jsonData",JSON.stringify({width:"2",height:"1",depth:"0.005",color:"#242424",x:"-7.7",y:"-6.8",z:"0.005",scaleX:"2",scaleY:"2",scaleZ:"1",text:"Prev"})),1===b.data.length?this.leftNav.setAttribute("visible","false"):(this.leftNav.setAttribute("class","link"),this.leftNav.setAttribute("button-design","")),this.el.appendChild(this.leftNav),this.rightNav=document.createElement("a-entity"),this.rightNav.setAttribute("id","nav-button-right"),this.rightNav.setAttribute("text-box","jsonData",JSON.stringify(f)),this.rightNav.setAttribute("class","link"),this.rightNav.setAttribute("button-design",""),this.el.appendChild(this.rightNav);let g=e;const h=this.rightNav;addLearnMoreButton(b,a),this.leftNav.addEventListener("click",function(){if(0!==b.currPosition){if(--b.currPosition,b.data[b.currPosition].hasOwnProperty("imageSrc")){g&&c.removeChild(g),d.setAttribute("visible",!1);let a=createVisualPane(b,c);g=a,c.appendChild(a)}else d.setAttribute("visible",!0),g&&(c.removeChild(g),g=null),d.setAttribute("value",b.data[b.currPosition].text);addLearnMoreButton(b,a),h.firstChild.setAttribute("value","Next")}}),this.rightNav.addEventListener("click",function(){if(b.currPosition===b.data.length-2&&h.firstChild.setAttribute("value","Got it!"),b.currPosition!==b.data.length-1){if(++b.currPosition,b.data[b.currPosition].hasOwnProperty("imageSrc")){g&&c.removeChild(g),d.setAttribute("visible",!1);let a=createVisualPane(b,c);g=a,c.appendChild(a)}else d.setAttribute("visible",!0),g&&(c.removeChild(g),g=null),d.setAttribute("value",b.data[b.currPosition].text);addLearnMoreButton(b,a)}else b.hasOwnProperty("isTransition")&&b.isTransition?sceneComplete(0,b.transitionURL):(start_tutorial_flow=!0,c.sceneEl.emit("dcc-success-close-popup",{seconds:0,is_last_object:!1}))})}});function createVisualPane(a,b){visualPaneJson={isBlackboardTextDefined:a.isBlackboardTextDefined,isBlackboardParagraphDefined:a.isBlackboardTextDefined,imageSrc:a.data[a.currPosition].imageSrc,caption:a.data[a.currPosition].text};let c=document.createElement("a-entity");return c.setAttribute("id","visual-pane"),c.setAttribute("visual-pane","jsonData",JSON.stringify(visualPaneJson)),b.appendChild(c),c}function addLearnMoreButton(a,b){if(b.hasOwnProperty("learnMoreButton")&&(b.el.removeChild(b.learnMoreButton),delete b.learnMoreButton),a.data[a.currPosition].hasOwnProperty("link")){url=a.data[a.currPosition].link;try{checkUrlIsValid=new URL(url);b.learnMoreButton=document.createElement("a-entity"),b.learnMoreButton.setAttribute("id","button-learn-more"),b.learnMoreButton.setAttribute("text-box","jsonData",JSON.stringify({width:"4",height:"1",depth:"0.005",color:"#242424",x:"0",y:"-6.8",z:"0.005",scaleX:"2",scaleY:"2",scaleZ:"1",text:"Learn more!"})),b.learnMoreButton.setAttribute("class","link"),b.learnMoreButton.setAttribute("button-design",""),b.el.appendChild(b.learnMoreButton),b.learnMoreButton.addEventListener("click",function(){window.open(url,"_blank").focus()})}catch(a){}}}AFRAME.registerComponent("tutorial-instructions",{multiple:!0,init:function(){this.buttons=["a","w","s","d"],this.dir=["left","forward","backward","right"];const a=this.el;this.cur_idx=0,this.drag_done=!1,this.keyDownHandle=this.keyDownHandle.bind(this),this.dragHandle=this.dragHandle.bind(this),this.textLabel=document.createElement("a-text"),this.textLabel.setAttribute("id","text-instructions"),this.textLabel.setAttribute("value","Click and drag mouse to pan around"),this.textLabel.setAttribute("font","https://raw.githubusercontent.com/jaydhulia/aframe-fonts/master/fonts/poppins/Poppins-Medium.json"),this.textLabel.setAttribute("shader","msdf"),this.textLabel.setAttribute("color","white"),this.textLabel.setAttribute("align","center"),this.textLabel.setAttribute("position",{x:0,y:0,z:-1}),this.textLabel.setAttribute("width",1),a.appendChild(this.textLabel),window.addEventListener("keydown",this.keyDownHandle),window.addEventListener("mousedown",this.dragHandle)},keyDownHandle:function(a){if(!this.drag_done)return;const b=this.buttons,c=this.dir;if(a.key.toLowerCase()===b[this.cur_idx])if(this.cur_idx++,this.cur_idx<b.length)this.textLabel.setAttribute("value","Press \""+b[this.cur_idx]+"\" to move "+c[this.cur_idx]);else{window.removeEventListener("keydown",this.keyDownHandle);const a={data:[{text:"Great job! You can also pan around the room by clicking and dragging your mouse. During the escape room, you will have to interact with various objects to solve puzzles or get clues. To interact, click on the textbook (on teacher's desk) with your left mouse button. Give it a try!"}],currPosition:0,isTransition:!1},b=this.textLabel;setTimeout(function(){addTransition(a);const c=document.getElementById("9-obj");c.setAttribute("class","link"),c.setAttribute("visible","true"),b.setAttribute("value","Click on the textbook (on teacher's desk)!")},1e3)}},dragHandle:function(){if(!start_tutorial_flow)return;let a=!1;const b=b=>{(5<Math.abs(b.movementX)||5<Math.abs(b.movementY))&&(a=!0)};window.addEventListener("mousemove",b);const c=()=>{a&&(this.drag_done=!0,this.textLabel.setAttribute("value","Press \""+this.buttons[this.cur_idx]+"\" to move "+this.dir[this.cur_idx]),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",c),window.removeEventListener("mousedown",this.dragHandle))};window.addEventListener("mouseup",c)}}),AFRAME.registerComponent("tutorial-hints",{multiple:!0,init:function(){const a=this.el;this.clickHandler=this.clickHandler.bind(this),a.addEventListener("click",this.clickHandler)},clickHandler:function(){wipeBlackboard();const a=document.getElementById("text-instructions");a.setAttribute("value","Click on the Hints!");const b=document.getElementById("hint-button");b.setAttribute("visible","true");addTransition({data:[{text:"Throughout the escape room, there will be hints readily available for you to use. The use of hints is optional, but feel free to check it out whenever you are stuck. Try accessing the hints now to get a clue for the password."}],currPosition:0,isTransition:!1}),this.el.removeAttribute("tutorial-hints"),this.el.removeEventListener("click",this.clickHandler)}});AFRAME.registerComponent("visual-pane",{schema:{jsonData:{parse:JSON.parse,stringify:JSON.stringify},isSolved:{type:"map"}},multiple:!0,init:function(){const a=this.data.jsonData,b=this.el;let c=document.createElement("a-image");c.setAttribute("src",a.imageSrc+"?d="+new Date().getTime()/1e3);let d=document.createElement("img");d.onload=function(){const e=d.width/d.height;let f=0,g=12;a.isBlackboardTextDefined&&a.hasOwnProperty("caption")&&""!==a.caption?g=9:a.isBlackboardTextDefined?(f=-.5,g=10):a.hasOwnProperty("caption")&&""!==a.caption&&(f=1,g=10);const h=17/g;if(e>=h?(c.setAttribute("width",17),c.setAttribute("height",17/e)):(c.setAttribute("width",g*e),c.setAttribute("height",g)),a.hasOwnProperty("scaleBy")&&(c.setAttribute("width",a.scaleBy*e),c.setAttribute("height",a.scaleBy)),a.hasOwnProperty("position")?b.setAttribute("position",{x:a.position[0],y:a.position[1],z:a.position[2]}):b.setAttribute("position",{x:0,y:f,z:0}),b.appendChild(c),a.hasOwnProperty("caption")){let d=document.createElement("a-text");d.setAttribute("id","text"),d.setAttribute("value",a.caption),d.setAttribute("negate","true"),d.setAttribute("scale","2 2 1"),d.setAttribute("font","https://raw.githubusercontent.com/jaydhulia/aframe-fonts/master/fonts/poppins/Poppins-Medium.json"),d.setAttribute("shader","msdf");let e=a.hasOwnProperty("textVerticalOffset")?a.textVerticalOffset:1,f=a.hasOwnProperty("textHorizontalOffset")?a.textHorizontalOffset:0;a.hasOwnProperty("textPosition")&&"above"===a.textPosition?d.setAttribute("position",{x:-4.9+f,y:c.getAttribute("height")/1.6+e,z:.25}):d.setAttribute("position",{x:-4.9+f,y:-(c.getAttribute("height")/1.8+e),z:.25}),b.appendChild(d)}},d.crossOrigin="anonymous",d.src=a.imageSrc+"?d="+new Date().getTime()},remove:function(){for(let a=this.el;a.firstChild;)a.removeChild(a.lastChild)}});